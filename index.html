<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إضافة بطاقات صفراء للاعبين</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .player { margin: 10px; padding: 10px; border: 1px solid #333; display: inline-block; width: 150px; }
        #microphone { margin-top: 20px; cursor: pointer; font-size: 24px; }
        #transcript { margin-top: 20px; font-size: 18px; }
        .results { margin-top: 30px; }
    </style>
</head>
<body>
    <h1>إضافة بطاقات صفراء للاعبين</h1>
    <div class="results">
        <div class="player" id="player-mohamed">محمد - بطاقات صفراء: <span id="mohamed-cards">0</span></div>
        <div class="player" id="player-tarek">طارق - بطاقات صفراء: <span id="tarek-cards">0</span></div>
        <div class="player" id="player-khaled">خالد - بطاقات صفراء: <span id="khaled-cards">0</span></div>
    </div>

    <button id="microphone">🎤 اضغط للتحدث</button>
    <div id="transcript">النص المحوّل: <span id="recognized-text"></span></div>

    <script>
        // توحيد أسماء اللاعبين بدون همزات أو تاء مربوطة
        const players = {
            "محمد": 0,
            "طارق": 0,
            "خالد": 0
        };

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "ar-SA";

        document.getElementById("microphone").onclick = () => {
            recognition.start();
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.trim();
            document.getElementById("recognized-text").innerText = transcript;
            processCommand(transcript);
        };

        function processCommand(command) {
            const regex = /^بطاق[هة] صفراء (.+)$/;
            const match = command.match(regex);

            if (match) {
                let playerName = normalizeText(match[1]);
                if (players[playerName] !== undefined) {
                    addYellowCard(playerName);
                } else {
                    const suggestions = findPartialMatches(playerName);
                    if (suggestions.length > 0) {
                        let suggestionText = "هل كنت تقصد: \n";
                        suggestions.forEach((suggestion, index) => {
                            suggestionText += `${index + 1}. ${suggestion}\n`;
                        });
                        suggestionText += "\nاختر رقم اللاعب أو اضغط إلغاء.";
                        let choice = prompt(suggestionText);
                        if (choice && suggestions[choice - 1]) {
                            addYellowCard(suggestions[choice - 1]);
                        }
                    } else {
                        alert("اللاعب غير موجود.");
                    }
                }
            } else {
                alert("الرجاء قول 'بطاقة صفراء' متبوعًا باسم اللاعب.");
            }
        }

        function addYellowCard(playerName) {
            players[playerName]++;
            updatePlayerCards(playerName);
        }

        function updatePlayerCards(playerName) {
            const playerIds = {
                "محمد": "mohamed-cards",
                "طارق": "tarek-cards",
                "خالد": "khaled-cards"
            };
            
            document.getElementById(playerIds[playerName]).innerText = players[playerName];
            document.getElementById("recognized-text").innerText = ""; // مسح النص بعد المعالجة
        }

        function normalizeText(text) {
            return text.replace(/أ|إ|آ/g, "ا").replace(/ة$/, "ه");
        }

        function findPartialMatches(inputName) {
            inputName = normalizeText(inputName);
            const matches = [];

            for (let player in players) {
                let normalizedPlayer = normalizeText(player);
                if (normalizedPlayer.includes(inputName) || inputName.includes(normalizedPlayer)) {
                    matches.push(player);
                }
            }
            return matches;
        }
    </script>
</body>
</html>
